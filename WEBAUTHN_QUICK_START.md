# WebAuthn 快速使用指南

## 登录界面功能说明

### 1. 查看 WebAuthn 按钮

登录页面现在有以下按钮：

#### 主登录区域：
- **"登录"按钮** - 传统的账号密码 + 二重认证登录
- **"🔐 使用设备认证登录"按钮** - 当检测到用户已绑定设备时显示（输入用户名后自动检测）

#### 底部按钮区域：
- **"还没有账号？点击注册"** - 跳转到注册页面
- **"🔐 绑定 WebAuthn 设备"** - 始终显示，点击进入设备绑定流程

### 2. 绑定设备流程

**步骤 1：准备**
1. 在登录页面输入用户名和密码（不要点击登录）
2. 点击底部的 **"🔐 绑定 WebAuthn 设备"** 按钮

**步骤 2：输入邀请码**
1. 在绑定页面会显示你输入的用户名
2. 输入邀请码（从管理员处获取）
3. 点击 **"开始绑定"** 按钮

**步骤 3：完成认证**
1. 浏览器会弹出认证提示
2. 按照提示完成生物识别（指纹、面部识别等）
3. 绑定成功后会显示提示

**注意事项：**
- 如果没有输入用户名和密码，会显示警告提示
- 绑定需要有效的邀请码
- 绑定过程中请不要关闭浏览器

### 3. 使用 WebAuthn 登录

**步骤 1：输入用户名**
1. 在登录页面输入用户名
2. 等待 0.5 秒，系统会自动检测是否有绑定设备

**步骤 2：点击 WebAuthn 登录**
1. 如果检测到已绑定设备，会显示 **"🔐 使用设备认证登录"** 按钮
2. 点击该按钮

**步骤 3：完成认证**
1. 浏览器弹出认证提示
2. 完成生物识别
3. 自动登录，跳过二重认证

### 4. 传统登录方式

如果不想使用 WebAuthn，或者设备未绑定：

1. 输入用户名和密码
2. 点击 **"登录"** 按钮
3. 完成二重认证流程
4. 登录成功

### 5. 管理已绑定设备

登录后在 Dashboard 页面：

1. 打开右侧边栏（点击"展开"按钮）
2. 滚动到 **"🔐 已绑定的设备"** 区域
3. 查看设备列表（显示绑定时间、最后使用时间）
4. 点击 **"删除"** 按钮可以移除设备

## 常见问题

### Q: 为什么看不到 "使用设备认证登录" 按钮？

**A:** 可能的原因：
1. 还没有输入用户名
2. 用户名输入后等待时间不够（需要 0.5 秒）
3. 该用户还没有绑定设备
4. 网络请求失败

**解决方法：**
- 输入用户名后等待 1 秒
- 检查浏览器控制台是否有错误
- 确认该用户已经绑定过设备

### Q: 绑定设备时提示 "请先输入用户名和密码"？

**A:** 需要先在登录页面输入用户名和密码，然后再点击"绑定 WebAuthn 设备"按钮。

### Q: 绑定失败，提示 "邀请码无效"？

**A:** 请联系管理员获取正确的邀请码。邀请码在服务器环境变量中配置。

### Q: WebAuthn 登录失败？

**A:** 可能的原因：
1. 使用了不同的设备（WebAuthn 凭证绑定到特定设备）
2. 凭证已被删除
3. 浏览器不支持 WebAuthn

**解决方法：**
- 使用绑定时的同一设备
- 重新绑定设备
- 使用传统登录方式

### Q: 如何在多个设备上使用 WebAuthn？

**A:** 每个设备都需要单独绑定：
1. 在设备 A 上绑定一次
2. 在设备 B 上再绑定一次
3. 每个设备都可以独立使用 WebAuthn 登录

### Q: 绑定设备按钮一直显示，是否正常？

**A:** 是的，这是正常的。"🔐 绑定 WebAuthn 设备" 按钮始终显示，方便用户随时绑定新设备。即使已经绑定过设备，也可以绑定更多设备。

## 浏览器兼容性检查

在使用前，请确认：
- ✅ 使用 Chrome 67+, Firefox 60+, Safari 13+, 或 Edge 18+
- ✅ 网站使用 HTTPS（或 localhost）
- ✅ 设备支持生物识别或有外部安全密钥

## 测试工具

可以使用 `test-webauthn.html` 文件测试 WebAuthn 功能：
1. 在浏览器中打开该文件
2. 测试浏览器支持情况
3. 测试设备绑定和认证流程

## 安全提示

1. **邀请码保密** - 不要在公开场合分享邀请码
2. **设备安全** - 确保设备本身的安全（设置锁屏密码等）
3. **定期检查** - 定期检查已绑定设备列表，删除不再使用的设备
4. **备用方式** - 始终记住账号密码，以防 WebAuthn 不可用

## 获取帮助

如果遇到问题：
1. 查看浏览器控制台错误信息
2. 检查 `WEBAUTHN_DEPLOYMENT.md` 中的故障排除章节
3. 联系系统管理员
